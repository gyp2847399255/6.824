# 成员分工情况

借鉴了 MIT6.824 课程的框架。主要代码为本人独自完成。

# 设计方案说明

## MapReduce 系统

### MapReduce

MapReduce 包含两种操作，Map 和 Reduce。

其中 Map 是按照用户定义的方式，将字符串（通常是文本内容）转化成一组键值对。这个操作虽然叫做 Map，但并不是一定是真正意义上的映射。转化出的键值对更应该叫做二元组，因为多个键值对可以有相同的 Key ，甚至可以 Key 和 Value 均相同。

Reduce 则是操作 Map 得到的键值对组。将其中 Key 相同键值对的全部 Value 按照用户定义的方式进行合并。

MapReduce 的典型应用是词频统计。

### 分布式处理

一个分布式的 MapReduce 系统，能将 Map 和 Reduce 操作分配给集群的不同设备(Worker)来处理。

MapReduce 系统，需要处理多个文件的 Map 操作和 Reduce 操作。

## 整体架构

集群中的设备分为协调者(coordinator)和工作者(Worker)。协调者负责进行集群的整体调度，工作者负责执行协调者分配的具体Map或Reduce工作。

## 通信方式

使用 rpc 交互（golang的rpc包）。由于测试是在一台电脑上进行，因此http rpc路径设为本地的一个目录。

# 程序模块说明

## 协调者(Coordinator)

协调者记录每个 Map 任务和 Reduce 任务的状态。

### 工作分配请求

当收到工作者向协调者发送的工作分配请求时，如果还有未分配的 Map 任务，则及时分配 Map 任务。如果 Map 都已经分配但未全部执行完，就让工作者先进行等待。如果Map都已经执行完但还有Reduce未分配，则让分配Reduce任务。如果Reduce都已经分配，则告诉工作者结束工作。如果一项 Map 或 Reduce 操作分配给一个 Worker 十秒后，Worker 还没有反馈运行结束，就认为这个 Worker 发生了崩溃，将其任务设为还未分配。

### 工作完成

当工作者通知协调者工作完成时，协调者将其任务设为已完成。如果是Map任务完成，需要记录中间结果写入的文件名。如果所有Map或Reduce任务都已经完成，则可以开始下一项任务或通知所有工作者任务结束。

### Map结果查询

当收到工作者对于Map结果的查询时，这时所有Map都已经结束，工作者正在执行Reduce任务。工作者需要提供其Reduce操作的操作号。协调者将此前记录的所有Map结果中，与此操作号对应所有文件名一起返回。

## 工作者(Worker)

### 工作分配请求

### 工作完成

### Map结果查询

# 运行结果

使用了6.824课程提供的自动测试。需要在linux/MacOS进行测试（因为需要unix文件系统）